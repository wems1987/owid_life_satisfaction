---
title: "Self-reported life satisfaction, 2014 to 2022"
output: 
  html_document:
    theme: united
---

<img src="Our_World_in_Data_logo.png" style='width: 100px; position:absolute; top:0; right:0; padding:10px;'/>

<link href='https://fonts.googleapis.com/css?family=Playfair Display' rel='stylesheet'>
<style>
h1 {
    font-family: Playfair Display, Georgia, Times New Roman, "Liberation Serif", serif;
}
</style>

```{r include = F}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# Load packages 
if(!require(pacman)) install.packages("pacman")
pacman::p_load(plotly, tidyverse, reactable, here)
```


```{r}

## Import data

happy_data <- 
  read_csv(here("data/share-of-people-who-say-they-are-happy.csv"), show_col_types = FALSE) %>% 
  rename(Country = Entity,
         `happy_data ladder score`=`Happiness: Happy (aggregate)`)

```

“Please imagine a ladder, with steps numbered from 0 at the bottom to 10 at the top. The top of the ladder represents the best possible life for you and the bottom of the ladder represents the worst possible life for you. On which step of the ladder would you say you personally feel you stand at this time?”

# {.tabset}

## 🔢 Table

```{r}
happy_data %>% 
  filter(Year %in% c(2014, 2022)) %>%
  pivot_wider(names_from = Year, values_from = `happy_data ladder score`, id_cols = Country) %>% 
  select(Country, `2014`, `2022`) %>% 
  mutate(`Absolute change` = round(`2022` - `2014`, 3)) %>% 
  mutate(`Relative change` = (`2022` - `2014`) / `2014`) %>% 
  reactable(
    columns = list(`Relative change` = colDef(format = colFormat(percent = TRUE, digits = 1))) 
  )
```

## 🌎 Map

```{r}
happy_data %>% 
  mutate(`happy_data ladder score` = round(`happy_data ladder score`, 2)) %>%
  plot_geo(width = 940) %>% 
  add_trace(
    z = ~`happy_data ladder score`,
    color = ~`happy_data ladder score`,
    locations = ~Code,
    text = ~Country,
    frame = ~Year, colors = "YlGn"
  ) %>% 
  colorbar(title = NULL)
```


## 📈 Chart

```{r}
# simple line chart of the data, for five countries on different continents (ggplot, piped into ggplotly)

class(happy_data$`happy_data ladder score`)

happy_data_chart <- happy_data %>% 
  filter(Country %in% c("Norway", "Australia", "Germany", "Bolivia", "Colombia", "Algeria"))%>%
  ggplot(aes(x = Year, y = `happy_data ladder score`, color = Country))+
  geom_line()+
  scale_y_continuous(limits = c(0, 100)) +
  labs(x = NULL,
       y = NULL, 
       color = NULL) +
  theme_minimal() 

ggplotly(happy_data_chart, width = 940)
```
